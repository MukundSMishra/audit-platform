# Quick Start: Company-First Audit Workflow

## ğŸ¯ What Changed?

### OLD WORKFLOW âŒ
```
Dashboard
  â†“
  â€¢ Select Act First
  â€¢ Enter Company Details
  â€¢ One company = One act only
  â€¢ No multi-act audits
```

### NEW WORKFLOW âœ…
```
Dashboard (Choose Company)
  â†“ 
Act Selector (Choose Acts - One or Multiple!)
  â†“
Audit View (Audit Acts Sequentially)
  â†“
  Act 1: Answer all questions
    â†’ Next Act button appears at end
  â†“
  Act 2: Answer all questions
    â†’ Complete All button appears
  â†“
Back to Dashboard
```

---

## ğŸš€ How to Use (Step-by-Step)

### Step 1: Create/Choose Company
**Screen: Dashboard**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auditor Dashboard                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Start New Factory Audit] button    â”‚
â”‚                                     â”‚
â”‚ Previous factories listed below:    â”‚
â”‚ â€¢ Factory A, Location X             â”‚
â”‚ â€¢ Factory B, Location Y             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Click "Start New Factory Audit" or select existing factory:

**Form:**
- Factory Name: "Tata Steel Unit 4" âœ“ Required
- Location: "Jamshedpur, Jharkhand" âœ“ Required  
- License Number: "LIC-2024-9988" (Optional)

Click **"Next: Choose Acts"** â†’ Go to Step 2

---

### Step 2: Select Compliance Acts
**Screen: Act Selector**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Select Compliance Acts                         â”‚
â”‚ ğŸ“ Tata Steel Unit 4, Jamshedpur, Jharkhand   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚ â˜ The Factories Act, 1948                      â”‚
â”‚   Factories Act                                â”‚
â”‚   Central Act for factory safety...            â”‚
â”‚   ğŸ“Œ 95 audit items                            â”‚
â”‚                                                â”‚
â”‚ â˜ Maharashtra Factories Rules, 1963            â”‚
â”‚   MH Factory Rules                             â”‚
â”‚   State-specific rules for Maharashtra...      â”‚
â”‚   ğŸ“Œ 102 audit items                           â”‚
â”‚                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total: 197 items across 0 selected acts       â”‚
â”‚                                                â”‚
â”‚ [Cancel]    [Start Audit for 0 Acts]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Actions:**
1. Click cards to select/deselect acts (checkmarks appear)
2. See live summary update: "Total: 197 items across 2 selected acts"
3. Click **"Start Audit for 2 Acts"** â†’ Go to Step 3

---

### Step 3: Conduct Audits
**Screen: Audit View**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â˜° Menu] Tata Steel Unit 4                                      â”‚
â”‚ âŠ™ Live Session | Factories Act (1/2) | Risk Score: 45 / 100    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ SIDEBAR (left)           â”‚  MAIN AREA (center)                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚ Current Act              â”‚  Q1: Is the factory                 â”‚
â”‚ Factories Act            â”‚  registered with...                 â”‚
â”‚ (1 of 2 acts)            â”‚                                     â”‚
â”‚                          â”‚  Risk Level: Critical               â”‚
â”‚ 15 / 95 answered         â”‚  Weight: 5/5 â­â­â­â­â­             â”‚
â”‚                          â”‚                                     â”‚
â”‚ Question Grid:           â”‚  [Options for answer]               â”‚
â”‚ â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”         â”‚  â€¢ Compliant                        â”‚
â”‚ â”‚1âœ“â”‚2âœ“â”‚3âœ“â”‚4 â”‚5 â”‚         â”‚  â€¢ Non-Compliant                    â”‚
â”‚ â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤         â”‚  â€¢ Delayed                          â”‚
â”‚ â”‚6 â”‚7 â”‚8 â”‚9 â”‚10â”‚         â”‚  [Evidence] [Comments]              â”‚
â”‚ â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜         â”‚                                     â”‚
â”‚ ... (grid continues)     â”‚  [Save]                             â”‚
â”‚                          â”‚                                     â”‚
â”‚ [Back to Acts]           â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [< Previous] Question 3 of 95 [Next >]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**While Auditing Act 1:**
- Answer each question (click status, add evidence/comments)
- Question grid shows progress (green = answered)
- Navigate with Previous/Next buttons OR click questions in grid
- Risk score updates in real-time

**When You Reach Last Question of Act 1:**
```
Bottom button changes from:
[Next >]  â†’  [Next Act â–¶]  (GREEN)

Popup asks:
"Factories Act audit complete. 
Ready to audit the next act?"
```

Click **[Next Act]** â†’ Load Act 2 questions

---

### Act 2: Same Process
```
Audit View switches to Act 2:
- Sidebar shows: "MH Factory Rules (2 of 2 acts)"
- New set of 102 questions loads
- All Act 1 answers are saved âœ“
- Answer Act 2 questions...
```

**When You Reach Last Question of Act 2:**
```
Bottom button changes from:
[Next >]  â†’  [Complete All âœ“]  (GREEN)

Popup asks:
"You have completed all audit questions. 
Review your answers?"
```

Click **[Complete All]** â†’ Session saved, back to Dashboard

---

## ğŸ“Š Data Organization

### Session Level
```
Company:        "Tata Steel Unit 4"
Location:       "Jamshedpur, Jharkhand"
Auditor:        user@company.com
Status:         "In Progress"
Acts Selected:  ["factories_act_1948", "maharashtra_factories_rules_1963"]
```

### Per-Act Tracking
```
Act 1: Factories Act (95 items)
â”œâ”€â”€ Q1: Status = "Compliant", Risk = 5, Contribution = 0
â”œâ”€â”€ Q2: Status = null (unanswered), Risk = 3, Contribution = 0
â”œâ”€â”€ Q3: Status = "Non-Compliant", Risk = 4, Contribution = 4
â””â”€â”€ ...

Act 2: MH Factory Rules (102 items)
â”œâ”€â”€ Q1: Status = "Non-Compliant", Risk = 5, Contribution = 5
â”œâ”€â”€ Q2: Status = "Delayed", Risk = 4, Contribution = 2
â”œâ”€â”€ Q3: Status = null, Risk = 2, Contribution = 0
â””â”€â”€ ...
```

Each answer tagged with:
- `act_id`: Which act it belongs to
- `question_id`: The specific question
- `status`: The auditor's finding
- `evidence_url`: Supporting document
- `remarks`: Auditor notes

---

## ğŸ”„ Workflow Transitions

```
Screen 1: DASHBOARD
â”‚
â”œâ”€ Action: "Start New Factory Audit"
â”œâ”€ Data: Factory Name, Location, License
â”‚
â†“
Screen 2: ACT SELECTOR
â”‚
â”œâ”€ Action: Select 1+ acts
â”œâ”€ Data: selectedActIds = [act1, act2, ...]
â”‚
â†“
Screen 3: AUDIT (Act 1)
â”‚
â”œâ”€ Action: Answer questions
â”œâ”€ Data: answers[q_id] = {status, evidence, remarks}
â”œâ”€ With: act_id = 'factories_act_1948'
â”‚
â”œâ”€ At Last Q: Click "Next Act"
â”‚
â†“
Screen 3: AUDIT (Act 2)
â”‚
â”œâ”€ Action: Answer questions
â”œâ”€ Data: answers[q_id] = {status, evidence, remarks}
â”œâ”€ With: act_id = 'maharashtra_factories_rules_1963'
â”‚
â”œâ”€ At Last Q: Click "Complete All"
â”‚
â†“
Screen 1: DASHBOARD
â”‚
â””â”€ Session saved, back to company selection
```

---

## ğŸ› ï¸ Technical Details for Developers

### Key Files Modified
```
src/
â”œâ”€â”€ App.jsx                  â† 3-screen orchestration
â”‚   â€¢ currentScreen state: 'dashboard' | 'act-selector' | 'audit'
â”‚   â€¢ selectedActIds array: Multiple acts!
â”‚   â€¢ currentActIndex: Position in array
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Dashboard.jsx        â† Company only (no act selector)
â”‚   â”œâ”€â”€ ActSelector.jsx      â† Multi-act picker (NEW)
â”‚   â””â”€â”€ AuditCard.jsx        â† Question display (unchanged)
â”‚
â””â”€â”€ data/
    â””â”€â”€ actRegistry.js       â† Act definitions (existing)
```

### Database Changes
```sql
ALTER TABLE session_answers 
ADD COLUMN act_id TEXT;  â† NEW! Tracks which act

-- Unique constraint ensures no duplicate answers per act
ALTER TABLE session_answers
ADD CONSTRAINT unique_session_question_act 
UNIQUE(session_id, question_id, act_id);
```

### State Flow
```javascript
// App.jsx states
const [currentScreen, setCurrentScreen] = useState('dashboard');
const [selectedActIds, setSelectedActIds] = useState([]);
const [currentActIndex, setCurrentActIndex] = useState(0);

// Current act is always:
const currentActId = selectedActIds[currentActIndex];

// When navigating to next act:
const nextAct = () => {
  if (currentActIndex < selectedActIds.length - 1) {
    setCurrentActIndex(prev => prev + 1);
  } else {
    // All acts done - return to dashboard
  }
};
```

---

## âœ… Testing Checklist

Run through this to verify everything works:

- [ ] **Dashboard**: Create new company "Test Factory" in "Test City"
- [ ] **ActSelector**: See both acts listed with correct descriptions
- [ ] **ActSelector**: Select only "Factories Act" 
- [ ] **ActSelector**: Change mind, select "MH Factory Rules" instead
- [ ] **ActSelector**: Select BOTH acts
- [ ] **Audit**: See "Factories Act (1/2)" in top bar
- [ ] **Audit**: Answer Q1 with "Compliant"
- [ ] **Audit**: Scroll to last question (Q95)
- [ ] **Audit**: See "Next Act" button (green)
- [ ] **Audit**: Click "Next Act"
- [ ] **Audit**: See "MH Factory Rules (2/2)" in top bar
- [ ] **Audit**: See Q1 (but from MH Rules, different)
- [ ] **Audit**: Scroll to Q102 (last of MH Rules)
- [ ] **Audit**: See "Complete All" button (green)
- [ ] **Audit**: Click "Complete All"
- [ ] **Dashboard**: Back to company list
- [ ] **Supabase**: Query session_answers - see answers for both act_ids

---

## ğŸ“ Example Audit Session

**Scenario:** Auditing a steel factory against both Factories Act and Maharashtra Rules

```
Time 1: 10:00 AM
â€¢ Intern logs in
â€¢ Selects "JSW Steel Plant A"
â€¢ Chooses both acts (2 acts, 197 total items)
â€¢ Starts with Factories Act (95 items)
â€¢ Completes 20 questions: 15 Compliant, 5 Non-Compliant
â€¢ Clicks "Next Act"

Time 2: 11:30 AM (continues with next act)
â€¢ Now on Maharashtra Factories Rules (102 items)
â€¢ Completes 30 questions: 25 Compliant, 2 Non-Compliant, 3 Delayed
â€¢ Clicks "Complete All"

Result:
âœ… Both acts audited
âœ… All 52 questions answered
âœ… 197 total items covered
âœ… Risk score calculated: 42/100
âœ… Report ready for review
```

---

## âš ï¸ Important Notes

1. **Act Selection is Flexible**
   - You can select 1 act or multiple
   - Acts audit sequentially (one at a time)
   - You see progress: "Act 1 of 3"

2. **Answers are Act-Specific**
   - Same question in different acts tracked separately
   - "Is factory registered?" â†’ Different answer in Act 1 vs Act 2
   - Each answer tagged with `act_id` in database

3. **Progress is Preserved**
   - When switching acts, previous answers saved
   - Can return to Acts to switch order (future feature)

4. **Database Migration Required**
   - Must run SQL: `ALTER TABLE session_answers ADD COLUMN act_id TEXT;`
   - See `MIGRATION_ACT_ID.md` for details

---

## ğŸ“ Support

For questions about the workflow:
- See `WORKFLOW_UPDATE.md` for detailed technical docs
- See `MIGRATION_ACT_ID.md` for database setup
- Check code comments in `App.jsx` for state logic
- Review `ActSelector.jsx` for multi-act selection UI

---

**Commit Hash:** bba6e35
**Status:** âœ… Ready for Testing
